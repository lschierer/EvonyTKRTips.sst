---
import {  getCollection } from 'astro:content';
import { Debug } from 'astro/components';


const curUrl = new URL(Astro.request.url);
const selection = curUrl.pathname;
let base = selection.substring(1).includes('/') ? selection.substring(1).split('/').reverse().pop() : selection;
base = base.endsWith('/')? base : base + '/';
base = base.startsWith('/')? base.substring(1) : base;
console.log(`selection is ${selection}, base is ${base}`)

let collection:collection = '';
let entries:collection = [];
switch(base) {
    case 'reports/':
        console.log(`matched reports section`)
        collection = 'legacyReports';
        entries= await getCollection(collection);
        break;
    default:
        collection = 'docs';
        entries= await getCollection(collection, ({id}) => {
            return id.startsWith(base)
        });

        break;
}

entries = entries.sort((a,b) =>{
  const temp = [a.slug.toString().toLowerCase(), b.slug.toString().toLowerCase()];
  if(a.data.sortOrder && b.data.sortOrder){
      return a.data.sortOrder - b.data.sortOrder;
  }
  return a.slug.toString().toLowerCase().localeCompare(b.slug.toString().toLowerCase());
});

let items: string[] = [];
entries.forEach((e) => {
    items.push({
        slug: e.slug,
        title: e.data.title,
        base: base
    });
})


console.log(`items of size ${items.length}`)
---

<script>
    import '@spectrum-web-components/sidenav/sp-sidenav.js';
    import '@spectrum-web-components/sidenav/sp-sidenav-heading.js';
    import '@spectrum-web-components/sidenav/sp-sidenav-item.js';
    import './SideNav'
</script>
<sp-nm items={JSON.stringify(items)}></sp-nm>
