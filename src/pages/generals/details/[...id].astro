---
export const prerender = true;
import type { ComponentProps } from 'astro/types';
import type { InferGetStaticParamsType, InferGetStaticPropsType, GetStaticPaths } from 'astro';

import StarlightPage from '@astrojs/starlight/components/StarlightPage.astro';
import General from "@components/general/General.astro"
import AllGenerals from "@components/general/AllGenerals.astro"
import AllConflicts from "@components/general/AllConflicts.astro"

type GeneralType = ComponentProps<typeof General>;


const DEBUG = false;

import { getEntry, getCollection } from "astro:content";

export const  getStaticPaths = (async () =>  {
  const blogEntries = await getCollection('generals');
  return blogEntries.map(entry => ({
    params: { id: entry.id }, props: { entry },
  }));
}) satisfies GetStaticPaths;

type Params = InferGetStaticParamsType<typeof getStaticPaths>;
type Props = InferGetStaticPropsType<typeof getStaticPaths>;

const { id }: Params = Astro.params;
if (id === undefined) {
  if (DEBUG) console.log(`id was undefined`)
  throw new Error("Id is required");
}

const entry = await getEntry("generals", id);

if (entry === undefined) {
  if (DEBUG) console.log(`${id} was not found`)
  return Astro.redirect("/404");
}



---
<StarlightPage frontmatter={{title: `Details for ${id}`,tableOfContents: true,}}>
    <AllGenerals></AllGenerals>
    <AllConflicts></AllConflicts>
    <General generalEntry={id}/>
    <slot/>
</StarlightPage>
